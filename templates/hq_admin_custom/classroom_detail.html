{% extends 'hq_admin_custom/base.html' %}
{% block title %}Class Detail | {{ class_name }}-{{ section_name }}{% endblock title %}
{% block content %}
<style>
    /* Using your existing CSS Variables */
    .classroom-banner {
        background: var(--hq-primary);
        color: white;
        padding: 25px 35px;
        border-radius: 8px;
        margin-bottom: 30px;
        border-bottom: 4px solid var(--hq-accent);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .banner-title h2 { margin: 0; font-weight: 800; letter-spacing: -0.5px; }
    .banner-title span { color: var(--hq-accent); font-weight: 700; text-transform: uppercase; font-size: 0.8rem; }

    .teacher-pill {
        background: rgba(255,255,255,0.1);
        padding: 8px 18px;
        border-radius: 4px;
        border-left: 3px solid var(--hq-accent);
        display: flex;
        flex-direction: column;
    }
    .teacher-pill small { font-size: 0.65rem; text-transform: uppercase; opacity: 0.7; font-weight: 700; }
    .teacher-pill b { font-size: 1rem; color: #CAD2C5; }

    /* Stats Section */
    .stat-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
    .stat-card-hq {
        background: white;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid var(--hq-border);
        text-align: center;
    }
    .stat-card-hq .label { display: block; font-size: 0.7rem; font-weight: 800; color: #94a3b8; text-transform: uppercase; margin-bottom: 5px; }
    .stat-card-hq .value { font-size: 1.8rem; font-weight: 800; color: var(--hq-primary); }

    /* Table Adjustments */
    .table-container-hq {
        background: white;
        border: 1px solid var(--hq-border);
        border-radius: 8px;
        overflow: hidden;
    }
    .table-hq thead { background: #f1f5f9; }
    .table-hq th { font-size: 0.75rem; font-weight: 800; color: #64748b; text-transform: uppercase; padding: 15px; border: none; }
    .table-hq td { padding: 15px; font-size: 0.9rem; border-bottom: 1px solid #f1f5f9; }

    .status-badge-hq {
        padding: 4px 12px;
        border-radius: 4px;
        font-size: 0.7rem;
        font-weight: 800;
        text-transform: uppercase;
    }
    .bg-p { background: #dcfce7; color: #166534; }
    .bg-a { background: #fee2e2; color: #991b1b; }
    .bg-l { background: #fef3c7; color: #92400e; }
</style>

<div class="classroom-banner shadow-sm">
    <div class="banner-title">
        <span>APS OKARA HQ / {{ wing_name|upper }} WING</span>
        <h2>Class {{ class_name }} - {{ section_name }}</h2>
    </div>
    
    <div class="teacher-pill">
        <small>Class In-Charge</small>
        <b><i class="fas fa-user-tie me-2" style="color: var(--hq-accent);"></i>{{ class_teacher }}</b>
    </div>
</div>

<div class="stat-row">
    <div class="stat-card-hq">
        <span class="label">Total Strength</span>
        <span class="value">{{ total_count }}</span>
    </div>
    <div class="stat-card-hq" style="border-bottom: 4px solid #10b981;">
        <span class="label text-success">Present</span>
        <span class="value text-success">{{ present_count }}</span>
    </div>
    <div class="stat-card-hq" style="border-bottom: 4px solid #ef4444;">
        <span class="label text-danger">Absent</span>
        <span class="value text-danger">{{ absent_count }}</span>
    </div>
    <div class="stat-card-hq" style="border-bottom: 4px solid #f59e0b;">
        <span class="label text-warning">Leave</span>
        <span class="value text-warning">{{ leave_count }}</span>
    </div>
</div>

<div class="card border-0 mb-4 shadow-sm">
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-3">
                <form method="GET" id="dateForm">
                    <input type="date" name="date" class="form-control" value="{{ selected_date }}" onchange="this.form.submit()">
                </form>
            </div>
            <div class="col-md-6">
                <div class="search-wrap" style="max-width: 100%;">
                    <i class="fas fa-search search-ico"></i>
                    <input type="text" id="studentSearch" class="search-field" placeholder="Search by student name or identity...">
                </div>
            </div>
            <div class="col-md-3">
                <select id="statusFilter" class="form-select" style="height: 40px; font-size: 0.9rem;">
                    <option value="">All Records</option>
                    <option value="PRESENT">Present</option>
                    <option value="ABSENT">Absent</option>
                    <option value="LEAVE">Leave</option>
                </select>
            </div>
        </div>
    </div>
</div>

<div class="table-container-hq shadow-sm">
    <table class="table table-hq align-middle mb-0">
        <thead>
            <tr>
                <th class="ps-4">Identity ID</th>
                <th>Student Name</th>
                <th>Father Name</th>
                <th class="text-center">Attendance Status</th>
            </tr>
        </thead>
        <tbody id="attendanceBody">
            {% for record in attendance_data %}
            <tr class="student-row" data-status="{{ record.status|upper }}">
                <td class="ps-4 fw-bold text-muted">{{ record.student.roll_number }}</td>
                <td class="fw-bold text-dark">{{ record.student.full_name }}</td>
                <td class="text-secondary">{{ record.student.father_name }}</td>
                <td class="text-center">
                    {% if record.status|upper == 'PRESENT' %}
                        <span class="status-badge-hq bg-p">Present</span>
                    {% elif record.status|upper == 'ABSENT' %}
                        <span class="status-badge-hq bg-a">Absent</span>
                    {% else %}
                        <span class="status-badge-hq bg-l">Leave</span>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="4" class="text-center py-5 text-muted">No records found for this date.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    const searchInput = document.getElementById('studentSearch');
    const statusFilter = document.getElementById('statusFilter');
    const rows = document.querySelectorAll('.student-row');

    function runFilter() {
        const q = searchInput.value.toUpperCase();
        const s = statusFilter.value.toUpperCase();
        rows.forEach(row => {
            const txt = row.innerText.toUpperCase();
            const stat = row.getAttribute('data-status');
            row.style.display = (txt.includes(q) && (s === "" || stat === s)) ? "" : "none";
        });
    }
    searchInput.addEventListener('keyup', runFilter);
    statusFilter.addEventListener('change', runFilter);
</script>
{% endblock content %}
